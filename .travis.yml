language: python
python:
  - "2.7"
sudo: required
services: docker

branches:
  only:
    - master
    - dev

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - sourceline: ppa:keithw/mahimahi
    packages:
      - gcc-7
      - g++-7

install:
  - sudo apt-get update -q
  - sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 99
  - sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 99
  - pip install matplotlib numpy tabulate pyyaml tensorflow

env:
  - SCHEMES="cubic vegas bbr ledbat pcc verus sprout scream webrtc copa taova vivace pcc_experimental fillp indigo fillp_sheep aurora eagle-v1 eagle-v2 eagle-001 eagle-003 eagle-004 eagle-005 eagle-006 eagle-007 eagle-008 eagle-009 eagle-001-1 eagle-001-2 eagle-001-3 eagle-001-4 eagle-expert-1 eagle-expert-2 eagle-expert-3 eagle-expert-4 eagle-expert-5 eagle-expert-6 eagle-expert-7 synthesizedBBR pythonBBR"

script:
  - ./tools/install_deps.sh &&
    ./src/experiments/setup_system.py --enable-ip-forward --set-all-mem --qdisc fq &&
    ./src/experiments/setup.py --schemes "$SCHEMES" --install-deps &&
    ./src/experiments/setup.py --schemes "$SCHEMES" --setup &&
    ./tests/test_analyze.py --schemes "$SCHEMES"

notifications:
  email: false
